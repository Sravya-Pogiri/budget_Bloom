function D(_){var p,c;const y=new DOMParser().parseFromString(_,"text/html"),u=[],x=y.querySelector(".jsa_summary");if(x){const s=Array.from(x.querySelectorAll("li")).find(n=>{var e;return(e=n.textContent)==null?void 0:e.includes("Account Name")}),l=((p=s==null?void 0:s.textContent)==null?void 0:p.replace(/Account Name[:\s]+/i,"").trim())||"",t=Array.from(x.querySelectorAll("li")).find(n=>{var e;return(e=n.textContent)==null?void 0:e.includes("Current Balance")});if(t&&l.toLowerCase().includes("meal plan")){const n=(c=t.textContent)==null?void 0:c.match(/Current Balance[:\s]+(\d+\.?\d*)/i);if(n){const e=parseFloat(n[1]);u.push({accountName:l||"Meal Plan",balance:e,balanceType:"meal_swipes",lastUpdated:new Date().toISOString()})}}}return y.querySelectorAll("table.jsa_transactions").forEach(s=>{var a,d,f;const l=s.getAttribute("id")||"",t=s.previousElementSibling,n=((a=t==null?void 0:t.textContent)==null?void 0:a.trim())||l,e=Array.from(s.querySelectorAll("tr")).find(r=>{var i,S;const o=r.querySelector("td.jsa_desc");return((i=o==null?void 0:o.textContent)==null?void 0:i.includes("Current Balance"))||((S=o==null?void 0:o.textContent)==null?void 0:S.includes("Current balance"))});if(e){const r=e.querySelector("td.jsa_amount.pos");if(r){const i=(((d=r.textContent)==null?void 0:d.trim())||"").match(/(\d+\.?\d*)/),S=i?parseFloat(i[1]):0;let m="other";n.toLowerCase().includes("meal plan")||n.toLowerCase().includes("meal")?m="meal_swipes":n.toLowerCase().includes("dining")?m="dining_dollars":(n.toLowerCase().includes("ru express")||n.toLowerCase().includes("express"))&&(m="ru_express");const h=e.querySelector("th.jsa_month"),q=((f=h==null?void 0:h.textContent)==null?void 0:f.trim())||"";let b=new Date().toISOString();if(q)try{const g=new Date(q);isNaN(g.getTime())||(b=g.toISOString())}catch{b=new Date().toISOString()}u.push({accountName:n,balance:S,balanceType:m,lastUpdated:b})}}}),u}function F(_){var j;const y=new DOMParser().parseFromString(_,"text/html"),u=[],x=y.querySelector("table.jsa_transactions");if(x){const p=y.querySelector(".jsa_summary"),c=p==null?void 0:p.querySelector('li:has(span:contains("Account Name"))'),s=((j=c==null?void 0:c.textContent)==null?void 0:j.replace(/Account Name[:\s]+/i,"").trim())||"New Brunswick - 150 Meal Plan";Array.from(x.querySelectorAll("tr")).filter(t=>{var a;const n=t.querySelector("td.jsa_amount.neg, td.jsa_amount.pos"),e=t.querySelector("td.jsa_desc");return n!==null&&e&&!((a=e.textContent)!=null&&a.includes("Current Balance"))&&!t.querySelector("th.jsa_table-headers")}).forEach(t=>{var f,r,o,i;const n=t.querySelector("th.jsa_month"),e=t.querySelector("td.jsa_desc"),a=t.querySelector("td.jsa_amount.neg, td.jsa_amount.pos"),d=(a==null?void 0:a.querySelector("p.jsa_data-bal span"))||t.querySelector("td.jsa_balance.bal");if(n&&e&&a){const S=((f=n.textContent)==null?void 0:f.trim())||"",m=((r=e.textContent)==null?void 0:r.trim())||"",h=((o=a.textContent)==null?void 0:o.trim())||"",q=a.classList.contains("neg"),b=h.match(/(\d+\.?\d*)/),g=b?q?-parseFloat(b[1]):parseFloat(b[1]):0,A=(((i=d==null?void 0:d.textContent)==null?void 0:i.trim())||"").match(/(\d+\.?\d*)/),w=A?parseFloat(A[1]):0;(g<0||m.toLowerCase().includes("deposit"))&&u.push({date:S,location:m,amount:g,balanceAfter:w,accountName:s})}})}return u.length===0&&y.querySelectorAll("table.jsa_transactions").forEach(c=>{var e;const s=c.getAttribute("id")||"",l=c.previousElementSibling,t=((e=l==null?void 0:l.textContent)==null?void 0:e.trim())||s;Array.from(c.querySelectorAll("tr")).filter(a=>a.querySelector("td.jsa_amount.neg")!==null).forEach(a=>{var i,S,m,h;const d=a.querySelector("th.jsa_month"),f=a.querySelector("td.jsa_desc"),r=a.querySelector("td.jsa_amount.neg"),o=r==null?void 0:r.querySelector("p.jsa_data-bal span");if(d&&f&&r){const q=((i=d.textContent)==null?void 0:i.trim())||"",b=((S=f.textContent)==null?void 0:S.trim())||"",T=(((m=r.textContent)==null?void 0:m.trim())||"").match(/-?(\d+\.?\d*)/),A=T?-Math.abs(parseFloat(T[1])):0,M=(((h=o==null?void 0:o.textContent)==null?void 0:h.trim())||"").match(/(\d+\.?\d*)/),N=M?parseFloat(M[1]):0;u.push({date:q,location:b,amount:A,balanceAfter:N,accountName:t})}})}),u}function L(_){var c,s,l;const C=D(_),y=F(_),u=((c=C.find(t=>t.balanceType==="meal_swipes"))==null?void 0:c.balance)||0,x=((s=C.find(t=>t.balanceType==="dining_dollars"))==null?void 0:s.balance)||0,j=((l=C.find(t=>t.balanceType==="ru_express"))==null?void 0:l.balance)||0,p=C.length>0?C[0].lastUpdated:new Date().toISOString();return{mealSwipes:u,diningDollars:x,ruExpress:j,transactions:y.slice(0,10),lastUpdated:p}}export{D as parseMealPlanBalances,L as parseRutgersHTML,F as parseTransactions};
